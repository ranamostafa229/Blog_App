# Define the build environment

FROM node:14 AS build-env

# Install dependencies for the React app

WORKDIR /app/client
COPY package\*.json ./
RUN npm install
COPY . .

# Build the React app using Vite

RUN npm run build

# Install dependencies for the Node.js server

WORKDIR /app/server
COPY package\*.json ./
RUN npm install
COPY . .

# Build the Node.js server

RUN npm run build

# Define the runtime environment

FROM node:14 AS runtime-env

# Copy the built React app and Node.js server into the runtime environment

COPY --from=build-env /app/client/dist /app/client/dist
COPY --from=build-env /app/server /app/server

# Expose the port for the Node.js server

PORT 3000

# Run the Node.js server

CMD ["node", "/app/server/index.js"]
